<%- include('head'); -%>
<body class="hold-transition skin-blue sidebar-mini">
	<%- include('sidebar'); -%>

		<!-- =============================================== -->

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<h1>
					Dashboard
					<small>Graficos</small>
				</h1>
				<!-- <ol class="breadcrumb">
					<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
					<li><a href="#">Examples</a></li>
					<li class="active">Dashboard</li>
				</ol> -->
			</section>

			<!-- Main content -->
			<section class="content">

				<!-- Default box -->
				<div class="box">
					<div class="box-header with-border">
						<h3 class="box-title">Graficos</h3>

						<div class="box-tools pull-right">
							<button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
								title="Collapse">
								<i class="fa fa-minus"></i></button>
							<button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip"
								title="Remove">
								<i class="fa fa-times"></i></button>
						</div>
					</div>
					<div class="box-body">
						<div class="container-fluid">
							<div class="row mb-4">
									<!-- Select -->
									<div class="col-md-6">
										<select name="select" class="form-control" id="select">
											<% arquivos.forEach(function(files){ %>
												<option value=<%= files.nome %>><%= files.nome %></option>
											<% }) ;%>
										</select>
									</div>
									
									<!-- Botao -->
									<div class="col-md-6" style="margin-bottom: 20px">
										<button class="btn btn-success btn-flat" id='plotar'>Plotar</button>
									</div>
							</div>

							<div class="row">
									<div class="col-md-4">
										<label for="data_ini"> Data Inicial </label>
										<select class="form-control" id="data_ini"></select>
										
									</div>

									<div class="col-md-4">
										<label for="data_fim"> Data Final</label>
										<select class="form-control" id="data_fim"></select>										
										
									</div>
									<div class="col-md-4"> 
										<button class="btn btn-success btn-flat" id='media'>Média</button>
									</div>
							</div>

							<div class="row">
								<div class="col-md-3">
									
								</div>
								<div class="col-md-5">
									<div id="main" class="chart-container" style="width: 550px; height: 300px"></div>
									<!-- <canvas id="myChart" width="700" height="400"></canvas> -->

								</div>
								<div class="col-md-4"></div>								
							</div>
						</div>
						
						<!-- </div class="container">
							
							<div id="main" class="col-12" style="width: 600px; height: 400px"></div>
							<div id="main" class="col-12" style="width: 600px; height: 400px"></div>
							<div id="main" class="col-12" style="width: 600px; height: 400px"></div> -->

						<!-- </div> -->
						
					</div>
					<!-- /.box-body -->
					<div class="box-footer">
						
					</div>
					<!-- /.box-footer-->
				</div>
				<!-- /.box -->

			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->

		<footer class="main-footer">
			<div class="pull-right hidden-xs">
				<b>Version</b> 2.4.0
			</div>
			<strong>Copyright &copy; 2014-2016 <a href="https://adminlte.io">Almsaeed Studio</a>.</strong> All rights
			reserved.
		</footer>
	
		<!-- /.control-sidebar -->
		<!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
		<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<%- include('footer'); -%>

	<script>

		$("#media").on('click', function(){
			data_ini = $("#data_ini").val()
			data_fim = $("#data_fim").val()

			cont = 0
			soma = 0

			time.map((e) => {
				if(e >= data_ini && e <= data_fim){
					soma += data[time.indexOf(e)]
					cont++;
				}
			})

			media = soma / cont;
			alert(media)

			
		})

		$(document).ready(function () {
			$('.sidebar-menu').tree()
		})
		

		$("#plotar").on('click', function(){

			sendFile($("#select").children("option:selected").val())
			
		})
		
		// $(".js-example-data-array").on('select2:close', function(e) {
		// 	e.preventDefault()
		// 	$(".js-example-data-array").select2("close");

		// })

		function sendFile(nome) {


			console.log("recebi na funcao", nome)


			$.ajax({
				url: '/test',
				type: 'POST',
				data: {nome: nome},
				success: function (response) {
					var myChart = echarts.init(document.getElementById('main'));

					time = []
					data = []
					response.pressao.map((e) => {

						time.push(e.data)
						data.push(e.pressao)

					})

					$("#data_ini").select2({
						data: time,
						closeOnSelect: true

					})
					$("#data_fim").select2({
						data: time,
						closeOnSelect: true

					})
					
					
					option = {
						tooltip: {
							trigger: 'axis',
							position: function (pt) {
								return [pt[0], '10%'];
							}
						},
						title: {
							left: 'center',
							text: 'Gráfico de Pressão',
						},
						toolbox: {
							feature: {
								dataZoom: {
									yAxisIndex: 'none'
								},
								restore: {},
								saveAsImage: {}
							}
						},
						xAxis: {
							type: 'category',
							boundaryGap: false,
							data: time,
							triggerEvent: true
						},
						yAxis: {
							type: 'value',
							boundaryGap: [0, '100%']
							//triggerEvent: true
						},
						dataZoom: [{
							type: 'inside',
							start: 0,
							end: 10
						}, {
							start: 0,
							end: 10,
							handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
							handleSize: '80%',
							handleStyle: {
								color: '#fff',
								shadowBlur: 3,
								shadowColor: 'rgba(0, 0, 0, 0.6)',
								shadowOffsetX: 2,
								shadowOffsetY: 2
							}
						}],
						series: [
							{
								name:'Pressão',
								type:'line',
								smooth:true,
								symbol: 'none',
								sampling: 'average',
								itemStyle: {
									color: 'rgb(255, 70, 131)'
								},
								areaStyle: {
									color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
										offset: 0,
										color: 'rgb(255, 158, 68)'
									}, {
										offset: 1,
										color: 'rgb(255, 70, 131)'
									}])
								},
								data: data
							}
						]
					};
					myChart.setOption(option);
					
					myChart.on('click', function(params){
						data1 = params.value
						if(data1 == params.value){
							params.event.target.style.textBackgroundColor = "red"
						}
						
						alert(params.value)
					})


					

				},
				fail: function() {
					alert("Servidor em baixo ou falha de rede");
				}
			});
		}
	</script>
</body>

</html>